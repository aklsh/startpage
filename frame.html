<!doctype html>
<html>
<head>
	<base target="_blank">
	<meta charset="utf-8"/>
	<title>Marked in the browser</title>
	<style type="text/css">
		::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #000;
        }
		a {
			color: black;
		}
		code {
			background-color: rgba(0, 0, 0, 0.2);
			padding: 1px 4px 2px 4px;
			font-size: 15px;
		}
		pre {
			background-color: rgba(0, 0, 0, 0.2);
		}
		pre code {
			background-color: transparent;
		}
		blockquote {
			color: rgba(255, 255, 255, 0.7);
			padding-left: 10px;
			margin-left: 5px;
			border-left: 4px solid rgba(255, 255, 255, 0.7);
		}
		table {
			border-collapse: collapse;
		}
		th, td {
			border: 1px solid rgb(255, 255, 255, 0.8);
			padding: 4px;
		}
		h1, h2 {
			border-bottom: 1px solid rgba(255, 255, 255, 0.3);
			padding-bottom: 5px;
			margin-bottom: -5px;
		}
		.markdown {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
			color: white;
			display: block;
			margin-top: -20px;
			width: 100%;
			word-wrap: break-word;
		}
		.editor {
            font: 16px/1 Fira Code, monospace;
			color: white;
			outline: none;
			display: none;
			white-space: pre-wrap;
		}
        .window {
        	width: 100%;
        	height: 300px;
        	box-shadow: inset 0 0 2px yellowgreen;
        }
		.bOverlay {
			position: fixed;
            background-color: rgba(46, 52, 64, 0.5);
            font: 16px/1 Fira Code, monospace;
            color: white;
            transition-duration: 0.1s;
            outline: none;
            border: 2px solid #434C5E;
            padding: 5px;
            margin-top: 10px;
			z-index: 2;
			right: 10px;
			display: block;
		}
		.bOverlay:hover,
		active {
			background-color: #434C5E;
		}
	</style>
</head>
<body>
	<div>
		<button id="editButton" class="bOverlay" onclick="toEdit()">Edit</button>
		<button id="saveButton" class="bOverlay" onclick="toSave()" style="display:none;margin-top:3px">Save</button>
	</div>
	<div id="editor" class="editor" contenteditable="true"># Edit me</div>
	<div id="markdown" class="markdown"></div>
	<script>
		var args = window.location.search.substring(1).split('&');
		var randomColor = '#000';
		var noteId = 0;
		for (var i = 0; i < args.length; i++) {
			var arg = args[i].split('=');
			if (arg[0] == 'color') 
				randomColor = '#'+arg[1];
			if (arg[0] == 'noteId')
				noteKey = arg[1]
		}
		var rules = document.styleSheets[0].cssRules;
            for (var i = 0; i < rules.length; i++) {
                if (rules[i].selectorText == '::-webkit-scrollbar-thumb')
                    rules[i].style.background = randomColor;
                if (rules[i].selectorText == 'a') {
                	rules[i].style.color = randomColor;
                }
            }
	</script>
	<script src="markdown-it.min.js"></script>
	<script src="markdown-it-emoji.min.js"></script>
	<script>
		var md = window.markdownit().use(window.markdownitEmoji);
		function toEdit() {
			document.getElementById('editButton').style.display = 'none';
			document.getElementById('saveButton').style.display = 'block';
			document.getElementById('markdown').style.display = 'none';
			document.getElementById('editor').style.display = 'block';
		}
		function toSave() {
			var mk = document.getElementById('editor');

			let text = mk.innerText;
			noteData[noteKey].name = text.split('\n', 1)[0].trimLeft('# ');
			noteData[noteKey].content = text;
			localStorage.setItem('noteData', JSON.stringify(noteData));

			document.getElementById('markdown').innerHTML = md.render(text);
			document.getElementById('editButton').style.display = 'block';
			document.getElementById('saveButton').style.display = 'none';
			document.getElementById('markdown').style.display = 'block';
			document.getElementById('editor').style.display = 'none';
		}
	</script>
	<script>
		var noteData = JSON.parse(localStorage.getItem('noteData'));
    	document.getElementById('editor').innerHTML = noteData[noteKey].content;
    	toEdit();
    	toSave();
  	</script>
</body>
</html>